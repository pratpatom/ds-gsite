<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRD Data Dictionary - พจนานุกรมข้อมูลทรัพยากรบุคคล</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .fade-in { opacity: 0; transform: translateY(20px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <div class="container mx-auto px-4 py-8">
            <!-- Header Section -->
            <header class="text-center mb-12 fade-in">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">HRD Data Dictionary</h1>
                <h2 class="text-2xl text-gray-600 mb-4">พจนานุกรมข้อมูลทรัพยากรบุคคลด้านการวิจัย</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                    พจนานุกรมข้อมูลสำหรับระบบจัดการข้อมูลนักวิจัยและผลงานวิจัย ครอบคลุมข้อมูลการประเมินศักยภาพและประสิทธิภาพของนักวิจัย
                </p>
            </header>

            <!-- Loading State -->
            <div v-if="loading" class="text-center py-16">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                <p class="mt-4 text-gray-600">กำลังโหลดข้อมูล...</p>
            </div>

            <!-- Data Table Section -->
            <section v-else class="fade-in">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-4">
                        <h2 class="text-2xl font-semibold">โครงสร้างข้อมูล HRD</h2>
                        <p class="text-purple-100 mt-1">รายละเอียดของตัวแปรข้อมูลทรัพยากรบุคคลด้านการวิจัย</p>
                    </div>
                    
                    <!-- Summary Stats -->
                    <div class="bg-gray-50 px-6 py-4 border-b">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="text-2xl font-bold text-blue-600">{{ hrdData.length }}</div>
                                <div class="text-sm text-gray-600">จำนวนตัวแปร</div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="text-2xl font-bold text-green-600">{{ requiredFields }}</div>
                                <div class="text-sm text-gray-600">ช่องข้อมูลบังคับ</div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="text-2xl font-bold text-purple-600">{{ optionalFields }}</div>
                                <div class="text-sm text-gray-600">ช่องข้อมูลเสริม</div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="text-2xl font-bold text-orange-600">{{ dataTypeCount }}</div>
                                <div class="text-sm text-gray-600">ชนิดข้อมูลที่ใช้</div>
                            </div>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700 uppercase tracking-wider border-b">
                                        Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700 uppercase tracking-wider border-b">
                                        Data Type
                                    </th>
                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700 uppercase tracking-wider border-b">
                                        คำอธิบาย
                                    </th>
                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700 uppercase tracking-wider border-b">
                                        Required
                                    </th>
                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700 uppercase tracking-wider border-b">
                                        Example
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(item, index) in hrdData" :key="index" 
                                    class="hover:bg-gray-50 transition-colors duration-200"
                                    :class="index % 2 === 0 ? 'bg-white' : 'bg-gray-25'">
                                    <td class="px-6 py-4 text-sm font-mono text-blue-600 border-b">
                                        <span class="bg-blue-50 px-2 py-1 rounded">{{ item.Name }}</span>
                                    </td>
                                    <td class="px-6 py-4 text-sm border-b">
                                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs font-medium">
                                            {{ item['Data Type'] }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-700 border-b">
                                        {{ item['คำอธิบาย'] }}
                                    </td>
                                    <td class="px-6 py-4 text-sm border-b">
                                        <span :class="item.Required === 'YES' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'" 
                                              class="px-2 py-1 rounded-full text-xs font-medium">
                                            {{ item.Required }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-600 border-b">
                                        <div class="whitespace-pre-line max-w-xs">{{ item.Example }}</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Data Type Legend -->
            <section class="mt-12 fade-in">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gray-600 text-white px-6 py-4">
                        <h3 class="text-xl font-semibold">คำอธิบายชนิดข้อมูล</h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2">VARCHAR</h4>
                                <p class="text-sm text-gray-600">ข้อความที่มีความยาวจำกัด เหมาะสำหรับชื่อ, ตำแหน่ง</p>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2">DECIMAL</h4>
                                <p class="text-sm text-gray-600">ตัวเลขทศนิยม เหมาะสำหรับการนับจำนวนหรือคะแนน</p>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2">UUID</h4>
                                <p class="text-sm text-gray-600">รหัสประจำตัวเฉพาะที่ไม่ซ้ำกัน</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="mt-16 text-center text-gray-500 fade-in">
                <p class="text-sm">© 2024 HRD Data Dictionary - ระบบจัดการข้อมูลทรัพยากรบุคคลด้านการวิจัย</p>
                <p class="text-xs mt-2">ปรับปรุงล่าสุด: {{ lastUpdated }}</p>
            </footer>
        </div>
    </div>

    <script type="module">
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const hrdData = ref([]);
                const loading = ref(true);
                const lastUpdated = ref('');

                // Computed properties for statistics
                const requiredFields = computed(() => {
                    return hrdData.value.filter(item => item.Required === 'YES').length;
                });

                const optionalFields = computed(() => {
                    return hrdData.value.filter(item => item.Required === 'NO').length;
                });

                const dataTypeCount = computed(() => {
                    const types = new Set(hrdData.value.map(item => item['Data Type'].split('(')[0]));
                    return types.size;
                });

                // Load HRD data from GitHub
                const loadHrdData = async () => {
                    try {
                        loading.value = true;
                        const response = await fetch('https://raw.githubusercontent.com/pratpatom/ds-gsite/refs/heads/dev/data/hrd_data_dictionary.json');
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        hrdData.value = data;
                        
                        // Get last updated date from the data
                        const updatedItem = data.find(item => item.Name === 'updated_at');
                        if (updatedItem && updatedItem.Example) {
                            lastUpdated.value = updatedItem.Example;
                        } else {
                            lastUpdated.value = new Date().toLocaleDateString('th-TH');
                        }
                        
                    } catch (error) {
                        console.error('Error loading HRD data:', error);
                        // Fallback data
                        hrdData.value = [
                            {
                                "Name": "uuid",
                                "Data Type": "VARCHAR(36)",
                                "คำอธิบาย": "รหัสประจำตัวนักวิจัยแบบ UUID ที่สร้างจากเลขประจำตัวประชาชนและชื่อ-สกุล",
                                "Required": "YES",
                                "Example": "f747af7b-2944-de9a-3527-c9e3dc892121"
                            },
                            {
                                "Name": "position",
                                "Data Type": "VARCHAR(255)",
                                "คำอธิบาย": "ตำแหน่งงานของนักวิจัย",
                                "Required": "NO",
                                "Example": "นักวิชาการสาธารณสุข, พยาบาลวิชาชีพ"
                            }
                        ];
                        lastUpdated.value = 'ไม่สามารถโหลดข้อมูลได้';
                    } finally {
                        loading.value = false;
                    }
                };

                // Animation setup
                const animateElements = () => {
                    gsap.fromTo('.fade-in', 
                        { opacity: 0, y: 30 }, 
                        { 
                            opacity: 1, 
                            y: 0, 
                            duration: 0.8, 
                            stagger: 0.2,
                            ease: 'power2.out'
                        }
                    );
                };

                onMounted(async () => {
                    await loadHrdData();
                    setTimeout(animateElements, 100);
                });

                return {
                    hrdData,
                    loading,
                    lastUpdated,
                    requiredFields,
                    optionalFields,
                    dataTypeCount
                };
            }
        }).mount('#app');
    </script>
</body>
</html>